




IA â€“ Tree complet de pagini (frontend structure for ai-prompt-templates.com)

Include toate rutele funcÈ›ionale, structurÄƒ ierarhicÄƒ + rol (public, gated, admin), mapare la entitÄƒÈ›i din DB.
Fiecare paginÄƒ este tratatÄƒ ca un nod atomic Ã®n site architecture. Structura este scalabilÄƒ, modularÄƒ, validatÄƒ cu logica back-endului analizat.

ğŸŒ / â€” Public Root Layer
/                         â€“ Home (hero, CTA, top neuroni)
/search                  â€“ Search (FTS: title, summary, tags)
/pricing                 â€“ Abonamente (Free/Architect/Initiate/Elite)
/bundles                 â€“ ListÄƒ bundles (preÈ› root-2, CTA)
/bundles/:slug           â€“ Bundle detail + preview neuroni
/library                 â€“ LibrÄƒrie principalÄƒ (cu sidebar tree)
/library/:path*          â€“ Nod ierarhic (pag. neuroni)
/n/:slug                 â€“ Neuron Preview (public: v_neuron_public)
/legal/terms             â€“ Terms of Service
/legal/privacy           â€“ Privacy Policy
/legal/cookies           â€“ Cookie Policy
/404                     â€“ Not found
/403                     â€“ Forbidden

ğŸ” /auth â€” Autentificare & onboarding
/auth/sign-in            â€“ Email + magic link / password
/auth/sign-up            â€“ Ãnregistrare cont nou
/auth/magic-link         â€“ Confirmare magic link
/auth/reset              â€“ Resetare parolÄƒ

ğŸ§  /n/:slug/read â€” Neuron Full Access (gated)
/n/:slug/read            â€“ Livrare via RPC: content_full + watermark
                          â€“ VerificÄƒ: entitlement OR elite OR pool @ plan
                          â€“ DacÄƒ fail â†’ aratÄƒ motiv + upsell

ğŸ’³ /checkout â€” Stripe + monetizare
/checkout/neuron/:slug   â€“ Stripe one-off neuron
/checkout/bundle/:slug   â€“ Stripe one-off bundle
/checkout/subscribe/:tier â€“ Stripe subscribe page pentru Architect/Initiate/Elite
/checkout/success         â€“ Confirmare platÄƒ
/checkout/canceled        â€“ Anulare/timeout platÄƒ

ğŸ‘¤ /account â€” User Dashboard
/account                 â€“ Overview: plan activ, stats personale, ultimii unlocks
/account/subscription    â€“ Plan curent, schimbare, anulare
/account/purchases       â€“ Lista cumpÄƒrÄƒturi one-off/bundle + receipts
/account/entitlements    â€“ Neuroni deÈ›inuÈ›i (entitlement materializat)
/account/receipts        â€“ Bonuri achiziÈ›ii (snapshot version, titlu, preÈ›)
/account/settings        â€“ Profil, parolÄƒ, email, delete account

ğŸ§® /studio â€” Admin / Operator Panel
/studio                             â€“ Dashboard general
/studio/neurons                     â€“ Listare neuroni + create/edit
/studio/neurons/:id                 â€“ Editare neuron (versiuni, publish, preÈ› root-2)
/studio/tree                        â€“ Sidebar builder (drag&drop, poziÈ›ii)
/studio/bundles                     â€“ Listare pachete + compoziÈ›ie
/studio/bundles/:id                 â€“ Editare bundle
/studio/plans                       â€“ Definire planuri (10/40/70/100, stripe IDs)
/studio/pool                        â€“ Pool curent per tier (score, evergreen, refresh)
/studio/analytics                   â€“ Views, unlocks 14d, top neuroni
/studio/alerts                      â€“ Alert log (cap > 9974â‚¬, pool mismatch, access leaks)
/studio/receipts                    â€“ Audit bonuri (snapshot legal)
/studio/settings                    â€“ pricing_rules + settings (cap, root, webhook)
/studio/guard                       â€“ Audit privilegii (fuga de content_full RLS)
/studio/users                       â€“ Utilizatori, subs, purchases (role=admin only)

ğŸŒ² StructurÄƒ ierarhicÄƒ simplificatÄƒ (tree format)
/
â”œâ”€â”€ search
â”œâ”€â”€ pricing
â”œâ”€â”€ bundles
â”‚   â””â”€â”€ :slug
â”œâ”€â”€ library
â”‚   â””â”€â”€ :path*
â”œâ”€â”€ n
â”‚   â””â”€â”€ :slug
â”‚       â””â”€â”€ read
â”œâ”€â”€ legal
â”‚   â”œâ”€â”€ terms
â”‚   â”œâ”€â”€ privacy
â”‚   â””â”€â”€ cookies
â”œâ”€â”€ auth
â”‚   â”œâ”€â”€ sign-in
â”‚   â”œâ”€â”€ sign-up
â”‚   â”œâ”€â”€ magic-link
â”‚   â””â”€â”€ reset
â”œâ”€â”€ checkout
â”‚   â”œâ”€â”€ neuron/:slug
â”‚   â”œâ”€â”€ bundle/:slug
â”‚   â”œâ”€â”€ subscribe/:tier
â”‚   â”œâ”€â”€ success
â”‚   â””â”€â”€ canceled
â”œâ”€â”€ account
â”‚   â”œâ”€â”€ subscription
â”‚   â”œâ”€â”€ purchases
â”‚   â”œâ”€â”€ entitlements
â”‚   â”œâ”€â”€ receipts
â”‚   â””â”€â”€ settings
â””â”€â”€ studio
    â”œâ”€â”€ neurons
    â”‚   â””â”€â”€ :id
    â”œâ”€â”€ tree
    â”œâ”€â”€ bundles
    â”‚   â””â”€â”€ :id
    â”œâ”€â”€ plans
    â”œâ”€â”€ pool
    â”œâ”€â”€ analytics
    â”œâ”€â”€ alerts
    â”œâ”€â”€ receipts
    â”œâ”€â”€ settings
    â”œâ”€â”€ guard
    â””â”€â”€ users

# CODIFICARE ROLURI â€“ AI-PROMPT-TEMPLATES.COM

Format: [SECÈšIUNE]   | PUBLIC | AUTENTIFICAT | ADMIN

/                   |   âœ…   |      âœ…      |  âœ…
/search             |   âœ…   |      âœ…      |  âœ…
/pricing            |   âœ…   |      âœ…      |  âœ…
/bundles            |   âœ…   |      âœ…      |  âœ…
/bundles/:slug      |   âœ…   |      âœ…      |  âœ…
/library            |   âœ…   |      âœ…      |  âœ…
/library/:path      |   âœ…   |      âœ…      |  âœ…
/n/:slug            |   âœ…   |      âœ…      |  âœ…
/n/:slug/read       |   âŒ   |      âœ…      |  âœ…

/auth/sign-in       |   âœ…   |      âŒ      |  âŒ
/auth/sign-up       |   âœ…   |      âŒ      |  âŒ
/auth/magic-link    |   âœ…   |      âŒ      |  âŒ
/auth/reset         |   âœ…   |      âŒ      |  âŒ

/checkout/neuron/:slug     | âŒ | âœ… | âœ…
/checkout/bundle/:slug     | âŒ | âœ… | âœ…
/checkout/subscribe/:tier  | âŒ | âœ… | âœ…
/checkout/success          | âŒ | âœ… | âœ…
/checkout/canceled         | âŒ | âœ… | âœ…

/account                  | âŒ | âœ… | âœ…
/account/subscription     | âŒ | âœ… | âœ…
/account/purchases        | âŒ | âœ… | âœ…
/account/entitlements     | âŒ | âœ… | âœ…
/account/receipts         | âŒ | âœ… | âœ…
/account/settings         | âŒ | âœ… | âœ…

/legal/terms              | âœ… | âœ… | âœ…
/legal/privacy            | âœ… | âœ… | âœ…
/legal/cookies            | âœ… | âœ… | âœ…
/404                      | âœ… | âœ… | âœ…
/403                      | âœ… | âœ… | âœ…

/studio                   | âŒ | âŒ | âœ…
/studio/neurons           | âŒ | âŒ | âœ…
/studio/neurons/:id       | âŒ | âŒ | âœ…
/studio/tree              | âŒ | âŒ | âœ…
/studio/bundles           | âŒ | âŒ | âœ…
/studio/bundles/:id       | âŒ | âŒ | âœ…
/studio/plans             | âŒ | âŒ | âœ…
/studio/pool              | âŒ | âŒ | âœ…
/studio/analytics         | âŒ | âŒ | âœ…
/studio/alerts            | âŒ | âŒ | âœ…
/studio/receipts          | âŒ | âŒ | âœ…
/studio/settings          | âŒ | âŒ | âœ…
/studio/guard             | âŒ | âŒ | âœ…
/studio/users             | âŒ | âŒ | âœ…

Ãntre conÈ›inut È™i acces, construieÈ™te o hartÄƒ semanticÄƒ. Acest tree nu e doar site structure â€” e schema unei inteligenÈ›e care monetizeazÄƒ cunoaÈ™terea.





Backend â€” delta final. Ce mai lipseÈ™te ca sÄƒ fie â€battleâ€‘readyâ€

Ai baza solidÄƒ: modelare + triggere root=2, pool zilnic 10/40/70/100, cap 9.974â‚¬, preview via views, full via RPC cu watermark, snapshot la cumpÄƒrare, versionare imutabilÄƒ, telemetrie 14d.

1) RLS complet pe tabele â€userâ€‘ownedâ€ + SELECT doar prin view-uri publice
ActiveazÄƒ RLS È™i politici â€selfâ€‘onlyâ€ pe: user_subscriptions, user_purchases, user_entitlements, purchase_receipts. (Ãn fiÈ™iere, RLS e setat doar pe neurons; extinde-l.) 
Public citeÈ™te doar v_neuron_public / v_tree_public; mutÄƒ bundles & plans pe v_bundle_public / v_plans_public (views readâ€‘only), apoi REVOKE pe tabele brute. 

2) Rol â€adminâ€ explicit (pentru /studio) + politici
Tabel user_roles(user_id, role) cu ENUM ('admin','member').
Politici RLS: â€admin poate SELECT/INSERT/UPDATE/DELETEâ€ pe: neurons, library_tree*, bundles*, plans, tier_access_pool, pricing_rules, settings, system_alerts.
Helper: f_is_admin() pentru RPC securizate. (FiÈ™ierele actuale nu definesc rolul admin.) 

3) Stripe â€event log + idempotency + DLQâ€
Tabel stripe_events(id,type,payload,status,processed_at,error); UNIQUE(id) â†’ previne duble.
DLQ webhook_failures.
Procesare Ã®n tranzacÈ›ie: inserezi user_purchases (are deja UNIQUE pe stripe_payment_intent_id) â†’ triggerul Ã®È›i mintuieÈ™te automat entitlements + receipts. (Ai minting + receipts Ã®n loc, dar Ã®È›i lipseÈ™te jurnalul de evenimente.)

4) Guard Ã®mpotriva È™tergerii unui neuron cu obligaÈ›ii legale
Interzice DELETE pe neurons dacÄƒ existÄƒ user_entitlements sau purchase_receipts pentru acel neuron.
PoliticÄƒ: foloseÈ™te doar published=false (softâ€‘hide). (Acum FKs sunt CASCADE pe versiuni; riÈ™ti pierderea probei dacÄƒ permiÈ›i delete.)

5) Rate limiting pe livrarea conÈ›inutului full
Ãn rpc_get_neuron_full: cheamÄƒ f_rate_limit('uid:'||auth.uid()||':unlock', 60, '1 minute'); altfel RAISE EXCEPTION 'Rate limit'.
ProtejeazÄƒ de scraping programatic. (RPC-ul existÄƒ, dar fÄƒrÄƒ throttle.) 

6) Caseâ€‘insensitive uniques + validare slugs
Indexuri unice pe lower(slug) pentru neurons È™i bundles.
CHECK slug: slug ~ '^[a-z0-9]+(-[a-z0-9]+)*$'.
AliniazÄƒ cu f_ltree_label() din arbore (normalizezi etichetele). 

7) CÄƒutare robustÄƒ: unaccent + tsvector generat
Extensie unaccent.
ColoanÄƒ tsv GENERATED ALWAYS AS (to_tsvector('simple', unaccent(coalesce(title,'')||' '||coalesce(summary,'')))) STORED.
Index GIN pe tsv; query cu plainto_tsquery('simple', unaccent(:q)). (Acum indexul e pe expresie dinamicÄƒ.) 

8) Asset pipeline pentru neuron (imagini/fiÈ™iere)
Tabel neuron_assets(neuron_id, kind, storage_path, mime_type) + RLS readâ€‘only public doar cÃ¢nd neurons.published=true. (Nu existÄƒ Ã®n fiÈ™iere; ai nevoie pentru media & download gated.) 

9) GDPR minim: export + È™tergere asistatÄƒ
RPC rpc_export_my_data() (JSON cu subs, purchases, entitlements, analytics 30d).
È˜tergere asistatÄƒ: account_deletion_requests + worker care anonimizeazÄƒ PII; pÄƒstrezi purchase_receipts (obligaÈ›ii legale). (Exportul/È™tergerea nu sunt acoperite acum.) 

10) Observabilitate joburi cron
Tabel job_audit(job_name, ok, payload, created_at); logheazÄƒ rezultatele pentru: refresh_tier_access_pool_all, check_library_cap, preview_privileges_audit. (Ai pg_cron programat; adaugÄƒ audit trail.)

11) Views publice pentru monetizare
v_bundle_public (title, description, price, items) È™i v_plans_public (code, name, percent, monthly/annual).
GRANT SELECT pe views, REVOKE pe tabele. (Frontâ€‘endul /bundles//pricing cere surse curate.) 

12) Decizia â€Free = 10% FULL?â€ â€” finalizeaz-o Ã®n f_has_full_access
DacÄƒ vrei 10% FULL pe free: include ap.plan IN ('free','architect','initiate') Ã®n condiÈ›ia cu pool.
DacÄƒ nu: pÄƒstreazÄƒ free = preview only È™i documenteazÄƒ Ã®n UI. (Momentan funcÈ›ia nu include free.) 

13) RPC helperi pentru FE (evitÄƒ SELECT direct)
rpc_search_neurons(q, limit, offset) (foloseÈ™te tsv).
rpc_get_my_active_plan() â†’ returneazÄƒ planul activ (derivat din user_subscriptions).
rpc_list_my_entitlements() â†’ listÄƒ de neuroni deÈ›inuÈ›i. (Ai deja rpc_get_neuron_full; completeazÄƒ setul.) 

14) ProtecÈ›ii la consistenÈ›Äƒ bundle
View v_rel_bundle_issues (neuroni lipsÄƒ/nepublicaÈ›i Ã®n bundle) + alertÄƒ dacÄƒ apare rÃ¢nd. (Ai deja schema; pune watchdog-ul.) 

15) Sanitiza â€plansâ€ Ã®n producÈ›ie
CHECK existent: procent â†” cod + root=2 + free=0â‚¬.
AsigurÄƒ stripe IDs setate pentru nonâ€‘free (trigger deja prezent; valideazÄƒ seed). 

ExecutÄƒ Ã®n ordine (migrÄƒri noi)
16_rls_user_owned.sql â€” RLS + politici self/admin.
17_admin_roles.sql â€” user_roles + f_is_admin().
18_stripe_events_dlq.sql â€” event log + DLQ.
19_unaccent_search.sql â€” tsvector generated + index.
20_assets.sql â€” neuron_assets + RLS.
21_rpc_helpers.sql â€” search, my_plan, my_entitlements.
22_rls_public_views.sql â€” views v_bundle_public, v_plans_public + REVOKE tabele.
23_delete_guards.sql â€” blocare DELETE pe neuroni cu obligaÈ›ii.
24_gdpr.sql â€” export + cerere È™tergere.
25_cron_job_audit.sql â€” job_audit + wrapping pentru cronuri.