"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},9512:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>_,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{GET:()=>p,POST:()=>d});var a=s(3036),i=s(5736),n=s(5262),o=s(942),u=s(6981),l=s(2866),c=s(3516),m=s(5253);let d=(0,l.er)(l.rk.auth,e=>{let t=e.headers.get("x-forwarded-for"),s=t?t.split(",")[0]:"unknown";return`auth:${s}`})(async e=>{let t=Date.now();try{let s=e.headers.get("content-type");if(!s||!s.includes("application/json"))return(0,m.DL)("Invalid content type in auth request",{contentType:s}),o.NextResponse.json({success:!1,error:"Content-Type must be application/json"},{status:400});let r=await e.json(),a=(0,c.rI)(c.DH,r);if(!a.success){let e=a.errors;return(0,m.DL)("Invalid auth data",{errors:e,action:r.action,email:r.email?"provided":"missing"}),o.NextResponse.json({success:!1,error:"Invalid authentication data",details:e},{status:400})}let{email:i,password:n,action:l}=a.data,d=(function(){let e=Object.entries({NEXT_PUBLIC_SUPABASE_URL:process.env.NEXT_PUBLIC_SUPABASE_URL,SUPABASE_SERVICE_ROLE_KEY:process.env.SUPABASE_SERVICE_ROLE_KEY}).filter(([e,t])=>!t).map(([e])=>e);if(e.length>0)throw Error(`Missing required environment variables: ${e.join(", ")}`);try{new URL(process.env.NEXT_PUBLIC_SUPABASE_URL)}catch{throw Error("Invalid NEXT_PUBLIC_SUPABASE_URL format")}if(!process.env.SUPABASE_SERVICE_ROLE_KEY.startsWith("eyJ"))throw Error("Invalid SUPABASE_SERVICE_ROLE_KEY format")}(),(0,u.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1}}));if((0,m.DL)("Authentication attempt",{action:l,email:i.substring(0,3)+"***@"+i.split("@")[1],ip:e.headers.get("x-forwarded-for")?.split(",")[0]||e.headers.get("x-real-ip")||"unknown"}),"signup"===l){let{data:s,error:r}=await d.auth.signUp({email:i,password:n,options:{data:{subscription_tier:"explorer",created_at:new Date().toISOString(),signup_ip:e.headers.get("x-forwarded-for")?.split(",")[0]||e.headers.get("x-real-ip")||"unknown"}}});if(r)throw(0,m.H)("Signup failed",{email:i.substring(0,3)+"***@"+i.split("@")[1],error:r.message}),r;let a=Date.now()-t;return m.kg.performance("POST /api/auth signup",a,{userId:s.user?.id,email:i.substring(0,3)+"***@"+i.split("@")[1]}),o.NextResponse.json({success:!0,user:s.user,message:"User created successfully"})}if("signin"===l){let{data:e,error:s}=await d.auth.signInWithPassword({email:i,password:n});if(s)throw(0,m.H)("Signin failed",{email:i.substring(0,3)+"***@"+i.split("@")[1],error:s.message}),s;let r=Date.now()-t;return m.kg.performance("POST /api/auth signin",r,{userId:e.user?.id,email:i.substring(0,3)+"***@"+i.split("@")[1]}),o.NextResponse.json({success:!0,user:e.user,session:e.session,message:"Login successful"})}return(0,m.DL)("Invalid auth action",{action:l}),o.NextResponse.json({success:!1,error:"Invalid action"},{status:400})}catch(s){let e=Date.now()-t;return(0,m.H)("Auth API error",{duration:e,error:s instanceof Error?s.message:"Unknown error",stack:s instanceof Error?s.stack:void 0}),o.NextResponse.json({success:!1,error:"Authentication failed"},{status:500})}}),p=async()=>o.NextResponse.json({message:"Auth API is running",endpoints:["POST /api/auth (signup/signin)"],rateLimit:l.rk.auth}),g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/vadimcusnir/GitRepo/ai-prompt-templates/packages/ai-prompt-templates/app/api/auth/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:x}=g,_="/api/auth/route";function w(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},5253:(e,t,s)=>{var r;s.d(t,{DL:()=>o,H:()=>n,kg:()=>i}),function(e){e.ERROR="error",e.WARN="warn",e.INFO="info",e.DEBUG="debug"}(r||(r={}));class a{shouldLog(e){return!!this.isDevelopment||!this.isProduction||"error"===e||"warn"===e}formatMessage(e){let t=e.timestamp,s=e.level.toUpperCase(),r=e.message,a=e.context?` | Context: ${JSON.stringify(e.context)}`:"",i=e.error?` | Error: ${e.error.message}`:"";return`[${t}] ${s}: ${r}${a}${i}`}addToBuffer(e){this.logBuffer.push(e),this.logBuffer.length>this.maxBufferSize&&this.logBuffer.shift()}async sendToExternalService(e){if(this.isProduction&&"error"===e.level)try{await fetch("/api/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){console.error("Failed to send log to external service:",e)}}error(e,t,s){let r={level:"error",message:e,timestamp:new Date().toISOString(),context:t,error:s};this.addToBuffer(r),this.shouldLog("error")&&console.error(this.formatMessage(r)),this.sendToExternalService(r)}warn(e,t){let s={level:"warn",message:e,timestamp:new Date().toISOString(),context:t};this.addToBuffer(s),this.shouldLog("warn")&&console.warn(this.formatMessage(s))}info(e,t){let s={level:"info",message:e,timestamp:new Date().toISOString(),context:t};this.addToBuffer(s),this.shouldLog("info")&&console.info(this.formatMessage(s))}debug(e,t){let s={level:"debug",message:e,timestamp:new Date().toISOString(),context:t};this.addToBuffer(s),this.shouldLog("debug")&&console.debug(this.formatMessage(s))}security(e,t){let s={level:"warn",message:`SECURITY: ${e}`,timestamp:new Date().toISOString(),context:t};this.addToBuffer(s),console.warn(this.formatMessage(s)),this.sendToExternalService(s)}performance(e,t,s){let r={level:"info",message:`PERFORMANCE: ${e} took ${t}ms`,timestamp:new Date().toISOString(),context:s};this.addToBuffer(r),this.shouldLog("info")&&console.info(this.formatMessage(r))}getLogs(e){return e?this.logBuffer.filter(t=>t.level===e):[...this.logBuffer]}clearLogs(){this.logBuffer=[]}exportLogs(){return this.logBuffer.map(e=>this.formatMessage(e)).join("\n")}constructor(){this.isDevelopment=!1,this.isProduction=!0,this.logBuffer=[],this.maxBufferSize=100}}let i=new a,n=(e,t,s)=>i.error(e,t,s),o=(e,t)=>i.security(e,t)},2866:(e,t,s)=>{s.d(t,{er:()=>n,rk:()=>i});let r=new Map;async function a(e,t){let s=Date.now();t.windowMs;let a=r.get(e);return!a||a.resetTime<s?(r.set(e,{count:1,resetTime:s+t.windowMs}),{success:!0,remaining:t.max-1,resetTime:s+t.windowMs}):a.count>=t.max?{success:!1,remaining:0,resetTime:a.resetTime,message:t.message}:(a.count++,r.set(e,a),{success:!0,remaining:t.max-a.count,resetTime:a.resetTime})}setInterval(()=>{let e=Date.now();for(let[t,s]of r.entries())s.resetTime<e&&r.delete(t)},36e5);let i={auth:{windowMs:9e5,max:5,message:"Too many authentication attempts, please try again later",standardHeaders:!0,legacyHeaders:!1},api:{windowMs:6e4,max:100,message:"Too many requests, please try again later",standardHeaders:!0,legacyHeaders:!1},checkout:{windowMs:6e4,max:3,message:"Too many checkout attempts, please try again later",standardHeaders:!0,legacyHeaders:!1}};function n(e,t){return function(s){return async function(r,...i){let n=t(r),o=await a(n,e);return o.success?s(r,...i):new Response(JSON.stringify({error:o.message}),{status:429,headers:{"Content-Type":"application/json"}})}}}},3516:(e,t,s)=>{s.d(t,{DH:()=>o,Hi:()=>l,Pp:()=>i,TD:()=>u,i$:()=>n,rI:()=>c,z6:()=>m});var r=s(1309),a=s(9693);let i=r.Ry({title:r.Z_().min(1,"Title is required").max(200,"Title must be less than 200 characters").regex(/^[a-zA-Z0-9\s\-_.,!?()]+$/,"Title contains invalid characters"),cognitive_category:r.Km(["deep_analysis","meaning_engineering","cognitive_frameworks","consciousness_mapping","advanced_systems"]),difficulty_tier:r.Km(["foundation","advanced","expert","architect"]),preview_content:r.Z_().min(10,"Preview content must be at least 10 characters").max(1e3,"Preview content must be less than 1000 characters").refine(e=>!e.includes("<script"),"Preview content contains invalid HTML"),full_content:r.Z_().min(50,"Full content must be at least 50 characters").max(5e4,"Full content must be less than 50000 characters").refine(e=>!e.includes("<script"),"Full content contains invalid HTML"),cognitive_depth_score:r.Rx().int("Cognitive depth score must be an integer").min(1,"Cognitive depth score must be at least 1").max(10,"Cognitive depth score must be at most 10"),pattern_complexity:r.Rx().int("Pattern complexity must be an integer").min(1,"Pattern complexity must be at least 1").max(5,"Pattern complexity must be at most 5"),base_price_cents:r.Rx().int("Price must be an integer").min(100,"Price must be at least 100 cents (€1)").max(1e5,"Price must be at most 100000 cents (€1000)"),meaning_layers:r.IX(r.Z_()).min(1,"At least one meaning layer is required").max(10,"Maximum 10 meaning layers allowed").refine(e=>e.every(e=>e.length>=3&&e.length<=500&&!e.includes("<script")),"Meaning layers contain invalid content"),anti_surface_features:r.IX(r.Z_()).min(1,"At least one anti-surface feature is required").max(10,"Maximum 10 anti-surface features allowed").refine(e=>e.every(e=>e.length>=3&&e.length<=500&&!e.includes("<script")),"Anti-surface features contain invalid content"),required_tier:r.Km(["explorer","architect","initiate","master"]).default("explorer"),is_published:r.O7().default(!1),quality_score:r.Rx().int("Quality score must be an integer").min(1,"Quality score must be at least 1").max(10,"Quality score must be at most 10").default(5),meta_tags:r.IX(r.Z_()).max(20,"Maximum 20 meta tags allowed").default([]),keywords:r.IX(r.Z_()).max(50,"Maximum 50 keywords allowed").default([])}),n=i.partial().extend({id:r.Z_().uuid("Invalid prompt ID format"),updated_at:r.Z_().datetime().optional()}),o=r.Ry({email:r.Z_().email("Invalid email format").min(5,"Email too short").max(254,"Email too long"),password:r.Z_().min(8,"Password must be at least 8 characters").max(128,"Password too long").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain lowercase, uppercase and number"),action:r.Km(["signin","signup"])}),u=r.Ry({tier:r.Km(["explorer","architect","initiate","master"]),userId:r.Z_().uuid("Invalid user ID format")}),l=r.Ry({search:r.Z_().max(100,"Search query too long").optional(),category:r.Km(["deep_analysis","meaning_engineering","cognitive_frameworks","consciousness_mapping","advanced_systems"]).optional(),tier:r.Km(["explorer","architect","initiate","master"]).default("explorer"),difficulty:r.Km(["foundation","advanced","expert","architect"]).optional(),minPrice:r.Rx().int().min(0).optional(),maxPrice:r.Rx().int().min(0).optional(),minScore:r.Rx().int().min(1).max(10).optional(),maxScore:r.Rx().int().min(1).max(10).optional()});function c(e,t){try{let s=e.parse(t);return{success:!0,data:s}}catch(e){if(e instanceof a.jm)return{success:!1,errors:e.issues.map(e=>`${e.path.join(".")}: ${e.message}`)};return{success:!1,errors:["Validation failed"]}}}function m(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[522,753,309],()=>s(9512));module.exports=r})();