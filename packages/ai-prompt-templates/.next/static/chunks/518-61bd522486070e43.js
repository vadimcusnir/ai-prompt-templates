"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[518],{1695:function(e,r,t){var i=t(1219);t.o(i,"useRouter")&&t.d(r,{useRouter:function(){return i.useRouter}})},3518:function(e,r,t){t.d(r,{Z:function(){return a}});var i=t(7573),n=t(7653),s=t(1695),o=t(4250);function a(e){let{children:r,requiredTier:t="explorer",requireAuth:a=!0,fallback:l}=e,{user:u,userTier:c,loading:d}=(0,o.a)(),f=(0,s.useRouter)();if((0,n.useEffect)(()=>{if(!d){if(a&&!u){f.push("/auth");return}if(u&&"explorer"!==t){let e=["explorer","architect","initiate","master"];if(e.indexOf(c)<e.indexOf(t)){f.push("/pricing");return}}}},[u,c,d,a,t,f]),d)return l||(0,i.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc"},children:(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid #e5e7eb",borderTop:"4px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem auto"}}),(0,i.jsx)("p",{style:{color:"#6b7280"},children:"Verifying access..."})]})});if(a&&!u)return l||(0,i.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc"},children:(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",color:"#374151",marginBottom:"1rem"},children:"Authentication Required"}),(0,i.jsx)("p",{style:{color:"#6b7280",marginBottom:"1.5rem"},children:"Please sign in to access this page."}),(0,i.jsx)("button",{onClick:()=>f.push("/auth"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer"},children:"Sign In"})]})});if(u&&"explorer"!==t){let e=["explorer","architect","initiate","master"];if(e.indexOf(c)<e.indexOf(t))return l||(0,i.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc"},children:(0,i.jsxs)("div",{style:{textAlign:"center",maxWidth:"500px",padding:"2rem"},children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",color:"#374151",marginBottom:"1rem"},children:"Tier Upgrade Required"}),(0,i.jsxs)("p",{style:{color:"#6b7280",marginBottom:"1.5rem",lineHeight:"1.6"},children:["This content requires a ",t," tier or higher. Your current tier is ",c,"."]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[(0,i.jsx)("button",{onClick:()=>f.push("/pricing"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer"},children:"Upgrade Tier"}),(0,i.jsx)("button",{onClick:()=>f.push("/dashboard"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer"},children:"Back to Dashboard"})]})]})})}return(0,i.jsx)(i.Fragment,{children:r})}},4250:function(e,r,t){t.d(r,{AuthProvider:function(){return u},a:function(){return c}});var i=t(7573),n=t(7653),s=t(6940);t(4859);let o=()=>(0,s.createClientComponentClient)();var a=t(7200);let l=(0,n.createContext)(void 0);function u(e){let{children:r}=e,[t,s]=(0,n.useState)(null),[u,c]=(0,n.useState)(!0),[d,f]=(0,n.useState)("free"),g=o(),h=(0,n.useCallback)(async e=>{try{let{data:r,error:t}=await g.from("user_subscriptions").select("tier, status").eq("user_id",e).eq("status","active").single();t||!r?(a.kg.info("User has no active subscription, defaulting to free tier",{userId:e}),f("free")):(a.kg.info("User tier retrieved successfully",{userId:e,tier:r.tier}),f(r.tier))}catch(r){(0,a.H)("Error getting user tier",{userId:e,error:r instanceof Error?r.message:"Unknown error"}),f("free")}},[g]);(0,n.useEffect)(()=>{(async()=>{try{let{data:{session:r},error:t}=await g.auth.getSession();if(t)(0,a.H)("Error getting session",{error:t.message});else{var e;s(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&await h(r.user.id)}}catch(e){(0,a.H)("Session error",{error:e instanceof Error?e.message:"Unknown error"})}finally{c(!1)}})();let{data:{subscription:e}}=g.auth.onAuthStateChange(async(e,r)=>{var t,i;a.kg.info("Auth state changed",{event:e,userEmail:(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email)?r.user.email.substring(0,3)+"***@"+r.user.email.split("@")[1]:"none"}),s(null!==(i=null==r?void 0:r.user)&&void 0!==i?i:null),(null==r?void 0:r.user)?await h(r.user.id):f("free"),c(!1)});return()=>e.unsubscribe()},[h,g.auth]);let m=async(e,r)=>{try{var t;let{data:i,error:n}=await g.auth.signInWithPassword({email:e,password:r});if(n)return(0,a.H)("Sign in failed",{email:e.substring(0,3)+"***@"+e.split("@")[1],error:n.message}),{error:n.message};return a.kg.info("User signed in successfully",{userId:null===(t=i.user)||void 0===t?void 0:t.id,email:e.substring(0,3)+"***@"+e.split("@")[1]}),{}}catch(r){return(0,a.H)("Unexpected error during sign in",{email:e.substring(0,3)+"***@"+e.split("@")[1],error:r instanceof Error?r.message:"Unknown error"}),{error:"An unexpected error occurred"}}},p=async(e,r)=>{try{var t;let{data:i,error:n}=await g.auth.signUp({email:e,password:r});if(n)return(0,a.H)("Sign up failed",{email:e.substring(0,3)+"***@"+e.split("@")[1],error:n.message}),{error:n.message};if(i.user&&!i.user.email_confirmed_at)return a.kg.info("User signup successful, email confirmation required",{userId:i.user.id,email:e.substring(0,3)+"***@"+e.split("@")[1]}),{error:"Please check your email to confirm your account"};return a.kg.info("User signup successful",{userId:null===(t=i.user)||void 0===t?void 0:t.id,email:e.substring(0,3)+"***@"+e.split("@")[1]}),{}}catch(r){return(0,a.H)("Unexpected error during sign up",{email:e.substring(0,3)+"***@"+e.split("@")[1],error:r instanceof Error?r.message:"Unknown error"}),{error:"An unexpected error occurred"}}},v=async()=>{try{let{error:e}=await g.auth.signOut();e?(0,a.H)("Sign out error",{error:e.message}):a.kg.info("User signed out successfully",{userId:null==t?void 0:t.id,email:(null==t?void 0:t.email)?t.email.substring(0,3)+"***@"+t.email.split("@")[1]:"unknown"})}catch(e){(0,a.H)("Sign out error",{error:e instanceof Error?e.message:"Unknown error"})}},x=async()=>{t&&await h(t.id)};return(0,i.jsx)(l.Provider,{value:{user:t,loading:u,userTier:d,signIn:m,signUp:p,signOut:v,refreshUserTier:x},children:r})}let c=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7200:function(e,r,t){var i,n;t.d(r,{H:function(){return a},PN:function(){return u},kg:function(){return o},yN:function(){return l}}),(n=i||(i={})).ERROR="error",n.WARN="warn",n.INFO="info",n.DEBUG="debug";class s{shouldLog(e){return!!this.isDevelopment||!this.isProduction||"error"===e||"warn"===e}formatMessage(e){let r=e.timestamp,t=e.level.toUpperCase(),i=e.message,n=e.context?" | Context: ".concat(JSON.stringify(e.context)):"",s=e.error?" | Error: ".concat(e.error.message):"";return"[".concat(r,"] ").concat(t,": ").concat(i).concat(n).concat(s)}addToBuffer(e){this.logBuffer.push(e),this.logBuffer.length>this.maxBufferSize&&this.logBuffer.shift()}async sendToExternalService(e){if(this.isProduction&&"error"===e.level)try{await fetch("/api/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){console.error("Failed to send log to external service:",e)}}error(e,r,t){let i={level:"error",message:e,timestamp:new Date().toISOString(),context:r,error:t};this.addToBuffer(i),this.shouldLog("error")&&console.error(this.formatMessage(i)),this.sendToExternalService(i)}warn(e,r){let t={level:"warn",message:e,timestamp:new Date().toISOString(),context:r};this.addToBuffer(t),this.shouldLog("warn")&&console.warn(this.formatMessage(t))}info(e,r){let t={level:"info",message:e,timestamp:new Date().toISOString(),context:r};this.addToBuffer(t),this.shouldLog("info")&&console.info(this.formatMessage(t))}debug(e,r){let t={level:"debug",message:e,timestamp:new Date().toISOString(),context:r};this.addToBuffer(t),this.shouldLog("debug")&&console.debug(this.formatMessage(t))}security(e,r){let t={level:"warn",message:"SECURITY: ".concat(e),timestamp:new Date().toISOString(),context:r};this.addToBuffer(t),console.warn(this.formatMessage(t)),this.sendToExternalService(t)}performance(e,r,t){let i={level:"info",message:"PERFORMANCE: ".concat(e," took ").concat(r,"ms"),timestamp:new Date().toISOString(),context:t};this.addToBuffer(i),this.shouldLog("info")&&console.info(this.formatMessage(i))}getLogs(e){return e?this.logBuffer.filter(r=>r.level===e):[...this.logBuffer]}clearLogs(){this.logBuffer=[]}exportLogs(){return this.logBuffer.map(e=>this.formatMessage(e)).join("\n")}constructor(){this.isDevelopment=!1,this.isProduction=!0,this.logBuffer=[],this.maxBufferSize=100}}let o=new s,a=(e,r,t)=>o.error(e,r,t),l=(e,r)=>o.warn(e,r),u=(e,r)=>o.info(e,r)}}]);